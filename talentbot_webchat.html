<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TalentBot Web Chat with Voice Recording</title>
<script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #webchat { height: 500px; width: 100%; border: 1px solid #ccc; margin-bottom: 20px; }
    #controls { margin-bottom: 10px; }
    button { margin-right: 10px; }
</style>
</head>
<body>
<h2>TalentBot Web Chat</h2>
<p>Please click <strong>Start Recording</strong> and speak your feedback. When done, click <strong>Stop Recording</strong> to send it for transcription.</p>
 
  <div id="webchat" role="main"></div>
 
  <div id="controls">
<select id="language">
<option value="en-US">English (US)</option>
<option value="ar-EG">Arabic (Egypt)</option>
<option value="fr-FR">French</option>
<option value="es-ES">Spanish</option>
</select>
<button onclick="startRecording()">Start Recording</button>
<button onclick="stopRecording()">Stop Recording</button>
</div>
 
  <script>
      const secret = '6keQUvz9LPrj7Pve31jOs8JgU4fWqtix3ZtJ5eND4rxiDbkOTGoRJQQJ99BIACi5YpzAArohAAABAZBS1BIF.E4JGDpKAvArPrb22wiZoEdkwUnvO1JuZ5X23utWx6B4Q7QSfRmAFJQQJ99BIACi5YpzAArohAAABAZBS4MBr';
    const directLine = window.WebChat.createDirectLine({ secret });
 
    window.WebChat.renderWebChat({ directLine }, document.getElementById('webchat'));
 
    let mediaRecorder;
    let audioChunks = [];
 
    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
 
      mediaRecorder.ondataavailable = event => {
        if (event.data.size > 0) {
          audioChunks.push(event.data);
        }
      };
 
      mediaRecorder.start();
    }
 
    async function stopRecording() {
      mediaRecorder.stop();
 
      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        const formData = new FormData();
        formData.append('file', audioBlob, 'recording.wav');
        formData.append('language', document.getElementById('language').value);
 
          const response = await fetch('https://talentwebapp.azurewebsites.net/api/audio', {
          method: 'POST',
          body: formData
        });
 
        const result = await response.json();
        directLine.postActivity({
          type: 'message',
          from: { id: 'user1', name: 'User' },
          text: `Transcription: ${result.transcription}`
        }).subscribe();
      };
    }
</script>
</body>
</html>